# OData Basics
This is VERY BASIC, there are inaccuracies due to the simplification


## Basic Tutorial:
https://www.odata.org/getting-started/basic-tutorial/

## Protocol
https://docs.oasis-open.org/odata/odata/v4.01/odata-v4.01-part1-protocol.html ‚Üê The details of the types/actions/functions etc.
https://docs.oasis-open.org/odata/odata/v4.01/odata-v4.01-part2-url-conventions.html ‚Üê formatting the URL (so filters, sort, comparisons etc)

### As JSON:
https://docs.oasis-open.org/odata/odata-json-format/v4.01/odata-json-format-v4.01.html

### In .Net:
https://learn.microsoft.com/en-us/odata/webapi-8/overview

# Basic concepts:
## The big concepts are:
Types, Entities, Actions, Functions

## Types:
Description of a type of thing (Duh! üòâ)
You'd think it describes how you see the instance of the type, but it doesn't, quite. To really see what's in an instance grab one

## Entities:
Instance of a type, when that type isn't an action or function (sort of)

## Action:
A thing that can be done. May have a side effect. Use a POST request

## Function:
A thing that can be done that has no side effect. Use a GET request

Functions and actions can be bound or unbound (associated with a type/entity or not)

# Dealing with stuff:
## Finding instances of type:
https://\<HOST\>/\<SERVICE\>/\<Type\>?$count=true&$top=\<int\>&$filter=\<SeeFilters\>&$select=all

I like to do a request https://\<HOST\>/\<SERVICE\>/\<Type\>?$count=true&$top=1&$select=all 
which gives me the count of instances of the type, the available properties of one returned and let me decide if I want to request them all or not.

## Details of an instance of type:
https://\<HOST\>/\<SERVICE\>/\<Type\>('\<InstanceOfType\>')?$properties=FullDetails
where InstanceOfType is the integer ID of the instance. $properties=FullDetails will return all properties of the instance, whether set to a value or not

## Running an action:
https://\<HOST\>/\<SERVICE\>/\<Type\>('\<InstanceOfType\>')/Action

## Changing and Instance:
Note, delete and update can be done on a set of things, so the result of a filter can be the target

## Delete:
Delete an instance with a DELETE request

## Create:
Create an instance with a POST request with the minimum required attributes (trial and error to find out what these are, or include all of them from another instance)
e.g. POST to https://\<HOST\>/\<SERVICE\>/\<Type\>('\<InstanceOfType\>')
{'Name':'bestNameEver','attribute2':'moredetail','attribute3':{'subattribute':'dkljafhd'}}...

## Update:
Update an instance by POSTing the details of the change to the specific instance URL (doesn't have to be the whole type, just the change)
e.g. POST to https://\<HOST\>/\<SERVICE\>/\<Type\>('\<InstanceOfType\>')
{'Name':'changedName'}...

# Filters:
Look a bit like SQL, but it isn't. Burp will have SQL Exploit ‚Äògasms, but it‚Äôs wrong
Best bet is to look through the spec, it's not that hard to follow:
https://docs.oasis-open.org/odata/odata/v4.01/odata-v4.01-part2-url-conventions.html

a basic example might be $filter=contains(\<Attribute\>,'TheStringYouAreLookingFor')
There are all sorts of operators, such as: contains, concat,endswith, length, substring, has, in, lt, gt, eq, ne...
filters can be stacked

# To get the action for a Type:
1. Query for all Types - https://\<HOST\>/\<SERVICE\>/\<Type\>/TypeDef?$count=true&$top=\<CountOfTypes\>&$properties=FullDetails
2. Where Type has an ActionLinks value that is not null obtain the ActionLink ID for each ActionLink:
    
```
jq -r '.value[] | select(.ActionLinks != null)|"\(.Name),\(.ID),\(.ActionLinks.value[].ID)"' ./\<TypeDefsInFile\>.json)
```

3. Query for the ActionLink - https://\<HOST\>/\<SERVICE\>/\<ActionLinkTypeDefID\>('\<ActionLinkID\>')?$properties=FullDetails
4. Obtain the ActionTypeDef.ID for the ActionLink
5. Query for the ActionTypeDef to obtain the ActionName - https://\<HOST\>/\<SERVICE\>/\<Type\>/\<ActionTypeDef.TypeDefID\>('\<ActionTypeDef.ID\>')?$properties=FullDetails
